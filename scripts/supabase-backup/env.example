# Supabase Backup & Restore Environment Configuration
# 
# SECURITY WARNING: DO NOT COMMIT THIS FILE TO VERSION CONTROL!
# Add to .gitignore: scripts/supabase-backup/.env
#
# Copy this file to .env and fill in your actual values.

# =============================================================================
# Supabase CLI Authentication
# =============================================================================
# Get this from: supabase login (stores token automatically)
# Or from: https://app.supabase.com/account/tokens
SUPABASE_ACCESS_TOKEN=sbp_your_access_token_here

# =============================================================================
# Source Project (for backup)
# =============================================================================
# Find your project reference ID in Supabase Dashboard URL:
# https://app.supabase.com/project/{PROJECT_REF}/
# Or run: supabase projects list
PROJECT_REF=your_source_project_ref

# Source project organization ID (optional, for API calls)
ORG_ID=your_org_id

# =============================================================================
# Target Project (for restore)
# =============================================================================
# Create a new project first, then fill this in
NEW_PROJECT_REF=your_new_project_ref
NEW_ORG_ID=your_new_org_id

# =============================================================================
# Source Database Connection (Direct Connection)
# =============================================================================
# Get these from Supabase Dashboard:
# Settings → Database → Connection String → URI mode
# Format: postgres://[USER]:[PASSWORD]@[HOST]:[PORT]/[DATABASE]

PG_HOST=db.your-project-ref.supabase.co
PG_PORT=5432
PG_DATABASE=postgres
PG_USER=postgres
PG_PASSWORD=your_database_password_here

# Full connection string (alternative format)
DATABASE_URL=postgresql://postgres:your_password@db.your-project-ref.supabase.co:5432/postgres

# =============================================================================
# Target Database Connection (for restore)
# =============================================================================
NEW_PG_HOST=db.your-new-project-ref.supabase.co
NEW_PG_PORT=5432
NEW_PG_DATABASE=postgres
NEW_PG_USER=postgres
NEW_PG_PASSWORD=your_new_database_password

NEW_DATABASE_URL=postgresql://postgres:your_new_password@db.your-new-project-ref.supabase.co:5432/postgres

# =============================================================================
# Backup Configuration
# =============================================================================
# Where to store backups locally (relative or absolute path)
BACKUP_DIR=./backups

# Backup retention (days) - for automated cleanup
BACKUP_RETENTION_DAYS=7

# Compression level (1-9, where 9 is highest compression, slowest)
COMPRESSION_LEVEL=6

# =============================================================================
# Storage Configuration (Optional)
# =============================================================================
# For large storage buckets, use rclone or S3-compatible tools

# AWS S3 configuration (if syncing to S3)
AWS_ACCESS_KEY_ID=your_aws_key
AWS_SECRET_ACCESS_KEY=your_aws_secret
AWS_DEFAULT_REGION=us-east-1
S3_BACKUP_BUCKET=my-supabase-backups

# Rclone remote name (if using rclone)
RCLONE_REMOTE=my-s3-remote
RCLONE_BUCKET=my-supabase-backups

# =============================================================================
# Advanced Options
# =============================================================================
# Skip certain backup steps (set to "true" to skip)
SKIP_DATABASE=false
SKIP_FUNCTIONS=false
SKIP_SECRETS=false
SKIP_STORAGE=false

# Parallel downloads for storage (number of concurrent downloads)
PARALLEL_DOWNLOADS=4

# Maximum storage file size to download (in MB, set 0 for unlimited)
MAX_FILE_SIZE_MB=500

# Log level (DEBUG, INFO, WARN, ERROR)
LOG_LEVEL=INFO

# =============================================================================
# CI/CD Configuration
# =============================================================================
# In CI/CD pipelines, set these as environment variables instead of using .env
# 
# GitHub Actions example:
# - name: Backup Supabase
#   env:
#     SUPABASE_ACCESS_TOKEN: ${{ secrets.SUPABASE_TOKEN }}
#     PROJECT_REF: ${{ secrets.PROJECT_REF }}
#     PG_PASSWORD: ${{ secrets.PG_PASSWORD }}
#   run: ./scripts/supabase-backup/backup_supabase.sh
#
# GitLab CI example:
# backup:
#   script:
#     - export SUPABASE_ACCESS_TOKEN=$SUPABASE_TOKEN
#     - export PROJECT_REF=$PROJECT_REF
#     - ./scripts/supabase-backup/backup_supabase.sh
#   only:
#     - schedules

# =============================================================================
# Encryption (Optional but Recommended)
# =============================================================================
# GPG key ID or email for encrypting backups
GPG_RECIPIENT=your-email@example.com

# Encryption passphrase (for symmetric encryption)
# NEVER commit this! Use CI secrets or prompt for it
ENCRYPTION_PASSPHRASE=

# =============================================================================
# Notification Configuration (Optional)
# =============================================================================
# Webhook URL for backup completion notifications
WEBHOOK_URL=https://hooks.slack.com/services/YOUR/WEBHOOK/URL

# Email for notifications (requires configured mail server)
NOTIFICATION_EMAIL=admin@example.com
